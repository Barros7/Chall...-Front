<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <script
      src="https://kit.fontawesome.com/440ce9db79.js"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="./assets/scripts/main.js"></script>
    <title>G3 Tech</title>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <sidebar class="col-sm-2 navbar">
          <div class="row mx-1">
            <button
              type="button"
              class="btn btn-dark mx-2 border border-primary border-2"
              data-bs-toggle="modal"
              data-bs-target="#formularioRegisto"
            >
              Novo Funcionario
            </button>
          </div>
          <div class="row mx-3">
            <div class="text-center imagemPerfil">
              <img
                style="
                  padding: 1%;
                  border-radius: 50px;
                  border: 1px solid black;
                  height: 100px;
                  width: 100px;
                "
                id="profile-img"
                class="my-5"
              />
            </div>
            <div class="text-center" id="fullNameCurrentUser">
              <h6 class="text-center" style="font-weight: 900"></h6>
            </div>
          </div>
          <div class="row">
            <h6
              class="text-center my-1 p-1"
              style="background-color: rgb(32, 31, 31); color: antiquewhite"
            >
              Funcionários presente
            </h6>
            <div id="estadosFuncionarios">
              <!-- Lista dos funcionários ativos será renderizada aqui! -->
            </div>
          </div>
          <div class="row d-grid gap-2 col-6 mx-auto">
            <button
              class="btn btn-dark mt-5 buttonLogout"
              type="button"
              onclick="logout()"
            >
              Logout
            </button>
          </div>
          <div class="row py-4 mx-auto">
            <h4 id="hora"></h4>
          </div>
        </sidebar>
        <main class="col-sm-10">
          <header>
            <nav class="navbar navbar-dark bg-dark">
              <div class="container-fluid">
                <a href="https://picar-ponto.herokuapp.com" class="navbar-brand"
                  >G3 Tech</a
                >
              </div>
            </nav>
          </header>
          <section>
            <!--########################################################################
                    #                                                                          #
                    #                                                                          # 
                    #    Abaixo a Modal para registar novo funcionário a partir da dashboard   #
                    #                                                                          #
                    #                                                                          #
                    ################3#########################################################-->

            <div
              class="modal fade"
              id="formularioRegisto"
              tabindex="-1"
              role="dialog"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">
                      Adicionar Funcionario
                    </h4>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <form
                    id="formregister"
                    method="post"
                    enctype="multipart/form-data"
                  >
                    <div class="modal-body mx-3">
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="orangeForm-name"
                          >Primeiro Nome</label
                        >
                        <input
                          type="text"
                          name="name"
                          id="addform-name"
                          class="form-control validate"
                        />
                      </div>
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="orangeForm-name"
                          >Último Nome</label
                        >
                        <input
                          type="text"
                          name="surname"
                          id="addform-surname"
                          class="form-control validate"
                        />
                      </div>
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="orangeForm-name"
                          >Pin</label
                        >
                        <input
                          type="text"
                          name="pin"
                          id="addform-pin"
                          class="form-control validate"
                        />
                      </div>
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="orangeForm-name"
                          >Senha</label
                        >
                        <input
                          type="text"
                          name="pin"
                          id="addform-password"
                          class="form-control validate"
                        />
                      </div>
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="orangeForm-email"
                          >Email</label
                        >
                        <input
                          type="email"
                          name="email"
                          id="addform-email"
                          class="form-control validate"
                        />
                      </div>
                      <!-- <div class="row md-form mb-4">
                        <div class="col-sm-6">
                          <label
                            for="formFileMultiple"
                            class="form-label text-center"
                            >Submeter Foto</label
                          >
                          <input
                            class="form-control border bordder-primary"
                            type="file"
                            name="fotoPerfil"
                            id="formFileMultiple"
                            multiple
                          />
                        </div>
                        <div class="col-sm-6">
                          <label
                            for="formFileMultiple"
                            class="form-label text-center"
                            >Submeter Documento</label
                          >
                          <input
                            class="form-control border bordder-primary"
                            type="file"
                            name="documento"
                            id="formFileMultiple"
                            multiple
                          />
                        </div>
                      </div> -->
                      <div class="modal-footer d-flex justify-content-center">
                        <button
                          type="submit"
                          class="btn btn-default btn-rounded"
                        >
                          Adicionar Funcionario
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!--########################################################################
                    #                                                                          #
                    #                                                                          # 
                    #    Abaixo a Modal para atualizar dados do funcionário                    #
                    #                                                                          #
                    #                                                                          #
                    ################3#########################################################-->

            <div
              class="modal fade"
              id="formularioAtualizarDados"
              tabindex="-1"
              role="dialog"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">
                      Atualizar dados do Funcionário
                    </h4>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <form
                    method="post"
                    id="formEdit"
                    enctype="multipart/form-data"
                  >
                    <div class="modal-body mx-3">
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="editform-name"
                          >Primeiro Nome</label
                        >
                        <input
                          type="text"
                          name="firstName"
                          id="editform-name"
                          class="newFirstName form-control validate"
                          value=""
                        />
                      </div>
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="orangeForm-name"
                          >Último Nome</label
                        >
                        <input
                          type="text"
                          name="lastName"
                          id="editform-surname"
                          class="newLastName form-control validate"
                          value=""
                        />
                      </div>
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="orangeForm-email"
                          >Email</label
                        >
                        <input
                          type="email"
                          name="email"
                          id="editform-email"
                          class="newEmail form-control validate"
                          value=""
                        />
                      </div>
                      <div class="md-form mb-2">
                        <label
                          data-error="wrong"
                          data-success="right"
                          for="orangeForm-email"
                          >Senha</label
                        >
                        <input
                          type="email"
                          name="email"
                          id="editform-password"
                          class="newEmail form-control validate"
                          value=""
                        />
                      </div>
                      <div class="row md-form mb-4">
                        <div class="col-sm-6">
                          <label
                            for="formFileMultiple"
                            class="form-label text-center"
                            >Submeter Foto</label
                          >
                          <input
                            class="form-control border bordder-primary"
                            type="file"
                            name="image"
                            id="profile-image"
                          />
                        </div>
                        <div class="col-sm-6">
                          <label
                            for="formFileMultiple"
                            class="form-label text-center"
                            >Submeter Documento</label
                          >
                          <input
                            class="form-control border bordder-primary"
                            type="file"
                            name="documento"
                            id="document-pdf"
                          />
                        </div>
                      </div>
                      <div
                        class="modal-footer d-flex justify-content-center"
                        id="divButtonEdit"
                      >
                        <button
                          type="submit"
                          class="btn btn-default btn-rounded"
                        >
                          Atualizar Dados
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th scope="col">Id</th>
                  <th scope="col">Nome</th>
                  <th scope="col">Sobrenome</th>
                  <th scope="col">Email</th>
                  <th scope="col" class="text-center">Documento</th>
                  <th scope="col" class="text-center">Entrou</th>
                  <th scope="col" class="text-center">Saiu</th>
                  <th scope="col" class="text-center">Foto</th>
                  <th colspan="2" class="text-center">Ação</th>
                </tr>
              </thead>
              <tbody id="tabelaTodosFuncionarios"></tbody>
            </table>
          </section>
        </main>
      </div>
    </div>
    <script src="./resources/index.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js"
      integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc"
      crossorigin="anonymous"
    ></script>
    <script>
      getUsers();
      getUserInfo()

      document
        .querySelector("#formregister")
        .addEventListener("submit", (e) => {
          e.preventDefault();

          registerUser();
        });

      var id = null;

      function edit(id) {
        this.user_id = id;
      }

      document
        .getElementById("profile-image")
        .addEventListener("change", (e) => {
          const file = e.target.files[0];

          updateProfile(file, this.user_id);

          e.target.files = []
        });

      document
        .getElementById("document-pdf")
        .addEventListener("change", (e) => {
          const file = e.target.files[0];

          updateDocument(file, this.user_id);
          e.target.files = []
        });

      document.querySelector("#formEdit").addEventListener("submit", (e) => {
        e.preventDefault();

        const name = document.getElementById("editform-name").value;
        const surname = document.getElementById("editform-surname").value;
        const email = document.getElementById("editform-email").value;
        const password = document.getElementById("editform-password").value;

        const data = {
          ...(name.length > 0 ? { name } : {}),
          ...(surname.length > 0 ? { surname } : {}),
          ...(email.length > 0 ? { email } : {}),
          ...(password.length > 0 ? { password } : {}),
        };

        update(this.user_id, data);
      });
    </script>
  </body>
</html>
